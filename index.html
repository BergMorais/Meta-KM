<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mission Gate</title>
    <link rel="icon" href="https://lucide.dev/icons/target.svg" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      :root {
        --bg: #f5f7fb;
        --card: #ffffff;
        --text: #1f1f1f;
        --accent: #007bff;
        --accent-light: #e6f0ff;
        --shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }

      body.dark {
        --bg: #101010;
        --card: #1c1c1c;
        --text: #f1f1f1;
        --accent: #4da3ff;
        --accent-light: #1a2a40;
        --shadow: 0 6px 20px rgba(255, 255, 255, 0.05);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 16px;
        transition: background 0.3s, color 0.3s;
      }

      h1 {
        font-size: 1.6rem;
        text-align: center;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .dark-toggle {
        position: fixed;
        top: 15px;
        right: 15px;
        background: var(--card);
        border: none;
        padding: 10px 12px;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: var(--shadow);
        transition: background 0.3s, color 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
        width: 15%;
      }

      .card {
        background: var(--card);
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 20px;
        width: 100%;
        max-width: 420px;
        margin-bottom: 20px;
        transition: background 0.3s, color 0.3s, box-shadow 0.3s;
      }

      label {
        display: block;
        margin-top: 10px;
        font-weight: 600;
      }

      input,
      select {
        width: 100%;
        padding: 10px;
        margin-top: 4px;
        border-radius: 10px;
        border: 1px solid #ccc;
        background: var(--accent-light);
        color: var(--text);
        font-size: 1rem;
      }

      button {
        width: 100%;
        margin-top: 15px;
        padding: 12px;
        border: none;
        border-radius: 12px;
        background: var(--accent);
        color: #fff;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
      }

      button:hover {
        opacity: 0.9;
      }

      /* === Carrossel === */
      .carrossel-container {
        position: relative;
        overflow: hidden;
        border-radius: 16px;
      }

      .carrossel {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        padding-bottom: 10px;
        transition: all 0.3s ease;
      }

      .carrossel::-webkit-scrollbar {
        display: none;
      }

      .mission-card {
        scroll-snap-align: center;
        min-width: 280px;
        flex: 0 0 auto;
        background: var(--accent-light);
        border-radius: 14px;
        padding: 15px;
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: space-between;
        transition: transform 0.3s ease, opacity 0.3s ease, background 0.3s,
          box-shadow 0.3s;
      }

      .mission-card.completed {
        opacity: 0.6;
        text-decoration: line-through;
      }

      .mission-card span {
        font-size: 1rem;
        font-weight: 600;
      }

      .mission-card input {
        transform: scale(1.3);
        margin-top: 10px;
      }

      .mission-count {
        text-align: center;
        font-size: 1rem;
        margin: 10px 0;
        font-weight: 600;
      }

      .summary {
        text-align: center;
        font-size: 1.1rem;
        margin-bottom: 10px;
      }

      /* === Progress Bar === */
      .progress-bar {
        background: #ccc;
        border-radius: 10px;
        height: 12px;
        width: 100%;
        margin-bottom: 15px;
        overflow: hidden;
      }

      .progress-fill {
        background: var(--accent);
        height: 100%;
        width: 0%;
        transition: width 0.5s ease;
      }

      /* === Navegação Carrossel === */
      .carrossel-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: var(--card);
        box-shadow: var(--shadow);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
      }

      .carrossel-nav.left {
        left: 5px;
      }
      .carrossel-nav.right {
        right: 5px;
      }

      canvas {
        width: 100% !important;
        max-height: 300px;
      }

      @media (min-width: 768px) {
        h1 {
          font-size: 2rem;
        }
        .mission-card {
          min-width: 300px;
        }
      }
    </style>
  </head>
  <body>
    <button class="dark-toggle" id="toggleDark">
      <i data-lucide="moon"></i> Dark Mode
    </button>

    <h1><i data-lucide="target"></i>Mission Gate</h1>

    <div class="card">
      <h2><i data-lucide="settings"></i> Configurar Meta</h2>
      <label>Meta de ganhos (R$):</label>
      <input id="metaValor" type="number" placeholder="Ex: 150" />
      <label>Valor por KM (R$):</label>
      <input id="valorKm" type="number" step="0.01" placeholder="Ex: 1.80" />
      <label>Tipo de Missões:</label>
      <select id="tipoVariedade">
        <option value="suave">Suave (3–10 km)</option>
        <option value="ampla">Ampla (2–20 km)</option>
      </select>
      <button id="gerarBtn">
        <i data-lucide="list-checks"></i> Gerar Missões
      </button>
    </div>

    <div class="card" style="position: relative">
      <h2><i data-lucide="flag"></i> Missões do Dia</h2>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="mission-count" id="contadorMissoes">
        0 concluídas • 0 pendentes
      </div>

      <div class="carrossel-nav left" id="prevBtn">
        <i data-lucide="chevron-left"></i>
      </div>
      <div class="carrossel-nav right" id="nextBtn">
        <i data-lucide="chevron-right"></i>
      </div>

      <div class="carrossel-container">
        <div class="carrossel" id="listaMissoes"></div>
      </div>
    </div>

    <div class="card">
      <h2><i data-lucide="bar-chart-2"></i> Resumo</h2>
      <p class="summary" id="resumoTexto">Nenhuma missão concluída ainda.</p>
      <canvas id="grafico"></canvas>
    </div>

    <script>
      lucide.createIcons();

      const metaInput = document.getElementById("metaValor");
      const valorKmInput = document.getElementById("valorKm");
      const tipoVariedade = document.getElementById("tipoVariedade");
      const gerarBtn = document.getElementById("gerarBtn");
      const listaMissoes = document.getElementById("listaMissoes");
      const resumoTexto = document.getElementById("resumoTexto");
      const contadorMissoes = document.getElementById("contadorMissoes");
      const progressFill = document.getElementById("progressFill");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const toggleDark = document.getElementById("toggleDark");

      let missoes = [];
      let totalGanho = 0;
      let chart;

      // === Dark Mode toggle ===
      window.onload = () => {
        const dark = localStorage.getItem("darkMode");
        if (dark === "true") {
          document.body.classList.add("dark");
        }
        atualizarToggleIcon();
      };

      toggleDark.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        const darkOn = document.body.classList.contains("dark");
        localStorage.setItem("darkMode", darkOn);
        atualizarToggleIcon();
      });

      function atualizarToggleIcon() {
        const icon = toggleDark.querySelector("i");
        if (document.body.classList.contains("dark")) {
          icon.setAttribute("data-lucide", "sun");
          toggleDark.innerHTML = `<i data-lucide="sun"></i> Light Mode`;
        } else {
          icon.setAttribute("data-lucide", "moon");
          toggleDark.innerHTML = `<i data-lucide="moon"></i> Dark Mode`;
        }
        lucide.createIcons();
      }

      // === LocalStorage Missões ===
      const dadosSalvos = JSON.parse(localStorage.getItem("missoesIKP"));
      if (dadosSalvos) {
        missoes = dadosSalvos.missoes;
        metaInput.value = dadosSalvos.meta || "";
        valorKmInput.value = dadosSalvos.valorKm || "";
        tipoVariedade.value = dadosSalvos.tipo || "suave";
        renderMissoes();
        atualizarResumo();
      }

      // === Funções principais ===
      gerarBtn.addEventListener("click", () => {
        gerarMissoes();
        salvarLocalStorage();
      });

      function gerarMissoes() {
        const meta = parseFloat(metaInput.value);
        const valorKm = parseFloat(valorKmInput.value);
        const tipo = tipoVariedade.value;
        if (isNaN(meta) || isNaN(valorKm) || meta <= 0 || valorKm <= 0) {
          alert("Valores inválidos!");
          return;
        }
        missoes = [];
        let soma = 0;
        const minKm = tipo === "suave" ? 3 : 2;
        const maxKm = tipo === "suave" ? 10 : 20;
        while (soma < meta) {
          const km = parseFloat(
            (Math.random() * (maxKm - minKm) + minKm).toFixed(1)
          );
          const valor = parseFloat((km * valorKm).toFixed(2));
          missoes.push({ km, valor, done: false });
          soma += valor;
        }
        renderMissoes();
        atualizarResumo();
      }

      function renderMissoes() {
        listaMissoes.innerHTML = "";
        missoes.forEach((m, i) => {
          const div = document.createElement("div");
          div.className = "mission-card" + (m.done ? " completed" : "");
          div.innerHTML = `<span>${m.km} km • R$ ${m.valor.toFixed(2)}</span>
    <label><input type="checkbox" ${
      m.done ? "checked" : ""
    } onchange="toggleMissao(${i})"> Concluir</label>`;
          listaMissoes.appendChild(div);
        });
        atualizarContador();
        atualizarProgressBar();
        atualizarZoomCarrossel();
      }

      function toggleMissao(index) {
        missoes[index].done = !missoes[index].done;
        renderMissoes();
        atualizarResumo();
        salvarLocalStorage();
      }

      function atualizarContador() {
        const concluidas = missoes.filter((m) => m.done).length;
        const pendentes = missoes.length - concluidas;
        contadorMissoes.textContent = `${concluidas} concluídas • ${pendentes} pendentes`;
      }

      function atualizarResumo() {
        totalGanho = missoes
          .filter((m) => m.done)
          .reduce((acc, m) => acc + m.valor, 0);
        resumoTexto.textContent = `Total ganho: R$ ${totalGanho.toFixed(
          2
        )} de R$ ${metaInput.value || 0}`;
        atualizarGrafico();
        atualizarContador();
        atualizarProgressBar();
      }

      function atualizarProgressBar() {
        const meta = parseFloat(metaInput.value) || 0;
        const percent = meta > 0 ? Math.min((totalGanho / meta) * 100, 100) : 0;
        progressFill.style.width = percent + "%";
      }

      function atualizarGrafico() {
        const ctx = document.getElementById("grafico").getContext("2d");
        const valores = [
          totalGanho,
          Math.max(0, parseFloat(metaInput.value || 0) - totalGanho),
        ];
        const cores = ["#4da3ff", "#ccc"];
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Concluído", "Restante"],
            datasets: [{ data: valores, backgroundColor: cores }],
          },
          options: { plugins: { legend: { position: "bottom" } } },
        });
      }

      function salvarLocalStorage() {
        const dados = {
          missoes,
          meta: metaInput.value,
          valorKm: valorKmInput.value,
          tipo: tipoVariedade.value,
        };
        localStorage.setItem("missoesIKP", JSON.stringify(dados));
      }

      // === Navegação Carrossel ===
      prevBtn.addEventListener("click", () => {
        listaMissoes.scrollBy({ left: -300, behavior: "smooth" });
      });
      nextBtn.addEventListener("click", () => {
        listaMissoes.scrollBy({ left: 300, behavior: "smooth" });
      });

      // === Swipe Touch ===
      let isDown = false,
        startX,
        scrollLeft;
      listaMissoes.addEventListener("mousedown", (e) => {
        isDown = true;
        startX = e.pageX - listaMissoes.offsetLeft;
        scrollLeft = listaMissoes.scrollLeft;
      });
      listaMissoes.addEventListener("mouseleave", () => (isDown = false));
      listaMissoes.addEventListener("mouseup", () => (isDown = false));
      listaMissoes.addEventListener("mousemove", (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - listaMissoes.offsetLeft;
        const walk = (x - startX) * 2;
        listaMissoes.scrollLeft = scrollLeft - walk;
      });
      listaMissoes.addEventListener("touchstart", (e) => {
        isDown = true;
        startX = e.touches[0].pageX - listaMissoes.offsetLeft;
        scrollLeft = listaMissoes.scrollLeft;
      });
      listaMissoes.addEventListener("touchend", () => (isDown = false));
      listaMissoes.addEventListener("touchmove", (e) => {
        if (!isDown) return;
        const x = e.touches[0].pageX - listaMissoes.offsetLeft;
        const walk = (x - startX) * 2;
        listaMissoes.scrollLeft = scrollLeft - walk;
      });

      // === Zoom card central ===
      function atualizarZoomCarrossel() {
        const cards = document.querySelectorAll(".mission-card");
        const center = listaMissoes.scrollLeft + listaMissoes.offsetWidth / 2;
        cards.forEach((card) => {
          const cardCenter = card.offsetLeft + card.offsetWidth / 2;
          const diff = Math.abs(center - cardCenter);
          const scale = Math.max(0.85, 1 - diff / 500);
          card.style.transform = `scale(${scale})`;
        });
      }

      listaMissoes.addEventListener("scroll", atualizarZoomCarrossel);
      window.addEventListener("resize", atualizarZoomCarrossel);
    </script>
  </body>
</html>
