<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mission Gate (Carrossel com Setas)</title>
    <link rel="icon" href="https://lucide.dev/icons/target.svg" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      :root {
        --bg: #f5f7fb;
        --card: #ffffff;
        --text: #1f1f1f;
        --accent: #007bff;
        --accent-light: #e6f0ff;
        --shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }
      body.dark {
        --bg: #101010;
        --card: #1c1c1c;
        --text: #f1f1f1;
        --accent: #4da3ff;
        --accent-light: #1a2a40;
        --shadow: 0 6px 20px rgba(255, 255, 255, 0.05);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 16px;
        transition: background 0.3s, color 0.3s;
      }

      h1 {
        font-size: 1.6rem;
        text-align: center;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .dark-toggle {
        top: 15px;
        right: 15px;
        border: none;
        padding: 10px 12px;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: var(--shadow);
        background: var(--card);
        color: var(--text);
        transition: background 0.3s, color 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .card {
        background: var(--card);
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 20px;
        width: 100%;
        max-width: 420px;
        margin-bottom: 20px;
        position: relative;
      }

      input,
      select {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border-radius: 10px;
        border: 1px solid #ccc;
        background: var(--accent-light);
        color: var(--text);
        font-size: 1rem;
      }

      button {
        width: 100%;
        margin-top: 15px;
        padding: 12px;
        border: none;
        border-radius: 12px;
        background: var(--accent);
        color: #fff;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
      }

      button:hover {
        opacity: 0.9;
      }

      .carrossel-container {
        position: relative;
        overflow: hidden;
      }

      .carrossel {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        gap: 10px;
        padding-bottom: 10px;
        scroll-behavior: smooth;
      }

      .carrossel::-webkit-scrollbar {
        display: none;
      }

      .mission-card {
        scroll-snap-align: center;
        min-width: 280px;
        background: var(--accent-light);
        border-radius: 14px;
        padding: 15px;
        text-align: center;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .mission-card.completed {
        background: linear-gradient(135deg, #ff6b6b, #ff2e63);
        color: #fff;
      }

      .mission-card button {
        width: auto;
        background: var(--accent);
        padding: 8px 16px;
        border-radius: 10px;
        font-size: 0.9rem;
        margin-top: 10px;
      }

      .mission-card.completed button {
        background: #fff;
        color: #ff2e63;
      }

      .carrossel-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--card);
        box-shadow: var(--shadow);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 5;
      }

      .carrossel-nav.left {
        left: -10px;
      }

      .carrossel-nav.right {
        right: -10px;
      }

      .progress-bar {
        background: #ccc;
        border-radius: 10px;
        height: 12px;
        width: 100%;
        margin-bottom: 8px;
        overflow: hidden;
      }

      .progress-fill {
        background: var(--accent);
        height: 100%;
        width: 0%;
        transition: width 0.5s ease;
      }

      canvas {
        width: 100% !important;
        max-height: 300px;
      }

      @media (min-width: 768px) {
        .mission-card {
          min-width: 320px;
        }
      }
    </style>
  </head>

  <body>
    <button class="dark-toggle" id="toggleDark">
      <i data-lucide="moon"></i> Dark Mode
    </button>

    <h1><i data-lucide="target"></i>Mission Gate</h1>

    <div class="card">
      <h2><i data-lucide="settings"></i> Configurar Meta</h2>
      <label>Meta de ganhos (R$):</label>
      <input id="metaValor" type="number" placeholder="Ex: 150" />
      <label>Valor por KM (R$):</label>
      <input id="valorKm" type="number" step="0.01" placeholder="Ex: 1.80" />
      <label>Tipo de Missões:</label>
      <select id="tipoVariedade">
        <option value="suave">Suave (3–10 km)</option>
        <option value="ampla">Ampla (2–20 km)</option>
      </select>
      <button id="gerarBtn">
        <i data-lucide="list-checks"></i> Gerar Missões
      </button>
      <button id="resetarBtn" style="background: #ff5555">
        <i data-lucide="trash-2"></i> Resetar Tudo
      </button>
    </div>

    <div class="card">
      <h2><i data-lucide="flag"></i> Missões do Dia</h2>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div id="motivacaoTexto">Vamos começar sua jornada!</div>
      <div id="contadorMissoes">0 concluídas • 0 pendentes</div>

      <div class="carrossel-container">
        <div class="carrossel-nav left" id="prevBtn">
          <i data-lucide="chevron-left"></i>
        </div>
        <div class="carrossel-nav right" id="nextBtn">
          <i data-lucide="chevron-right"></i>
        </div>

        <div class="carrossel" id="listaMissoes"></div>
      </div>
    </div>

    <div class="card">
      <h2><i data-lucide="bar-chart-2"></i> Resumo</h2>
      <p id="resumoTexto">Nenhuma missão concluída ainda.</p>
      <canvas id="grafico"></canvas>
    </div>

    <script>
      lucide.createIcons();
      const metaInput = document.getElementById("metaValor");
      const valorKmInput = document.getElementById("valorKm");
      const tipoVariedade = document.getElementById("tipoVariedade");
      const gerarBtn = document.getElementById("gerarBtn");
      const resetarBtn = document.getElementById("resetarBtn");
      const listaMissoes = document.getElementById("listaMissoes");
      const resumoTexto = document.getElementById("resumoTexto");
      const contadorMissoes = document.getElementById("contadorMissoes");
      const progressFill = document.getElementById("progressFill");
      const motivacaoTexto = document.getElementById("motivacaoTexto");
      const toggleDark = document.getElementById("toggleDark");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      let missoes = [];
      let totalGanho = 0;
      let chart;

      // === DARK MODE ===
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      if (
        localStorage.getItem("darkMode") === "true" ||
        (!localStorage.getItem("darkMode") && prefersDark)
      ) {
        document.body.classList.add("dark");
      }
      atualizarToggle();
      toggleDark.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        localStorage.setItem(
          "darkMode",
          document.body.classList.contains("dark")
        );
        atualizarToggle();
      });
      function atualizarToggle() {
        toggleDark.innerHTML = document.body.classList.contains("dark")
          ? '<i data-lucide="sun"></i> Light Mode'
          : '<i data-lucide="moon"></i> Dark Mode';
        lucide.createIcons();
      }

      // === LOCAL STORAGE ===
      const dadosSalvos = JSON.parse(localStorage.getItem("missoesData"));
      if (dadosSalvos) {
        missoes = dadosSalvos.missoes;
        metaInput.value = dadosSalvos.meta;
        valorKmInput.value = dadosSalvos.valorKm;
        tipoVariedade.value = dadosSalvos.tipo;
        renderMissoes();
        atualizarResumo();
      }

      // === GERAR MISSÕES ===
      gerarBtn.addEventListener("click", () => {
        const meta = parseFloat(metaInput.value);
        const valorKm = parseFloat(valorKmInput.value);
        const tipo = tipoVariedade.value;
        if (!meta || !valorKm || meta <= 0 || valorKm <= 0)
          return alert("Valores inválidos!");
        missoes = [];
        let soma = 0;
        const minKm = tipo === "suave" ? 3 : 2;
        const maxKm = tipo === "suave" ? 10 : 20;
        while (soma < meta && missoes.length < 100) {
          const km = +(Math.random() * (maxKm - minKm) + minKm).toFixed(1);
          const valor = +(km * valorKm).toFixed(2);
          missoes.push({ km, valor, done: false });
          soma += valor;
        }
        salvar();
        renderMissoes();
        atualizarResumo();
      });

      // === RESET ===
      resetarBtn.addEventListener("click", () => {
        if (confirm("Deseja realmente apagar tudo?")) {
          missoes = [];
          localStorage.removeItem("missoesData");
          renderMissoes();
          atualizarResumo();
        }
      });

      // === RENDERIZAÇÃO ===
      function renderMissoes() {
        listaMissoes.innerHTML = "";
        missoes.forEach((m, i) => {
          const div = document.createElement("div");
          div.className = "mission-card" + (m.done ? " completed" : "");
          div.innerHTML = `
            <div><i data-lucide="route"></i> ${m.km} km</div>
            <div><i data-lucide="wallet"></i> R$ ${m.valor.toFixed(2)}</div>
            <button><i data-lucide="${m.done ? "rotate-ccw" : "check"}"></i> ${
            m.done ? "Desfazer" : "Concluir"
          }</button>
          `;
          div
            .querySelector("button")
            .addEventListener("click", () => toggleMissao(i));
          listaMissoes.appendChild(div);
        });
        lucide.createIcons();
        atualizarContador();
      }

      function toggleMissao(i) {
        missoes[i].done = !missoes[i].done;
        salvar();
        renderMissoes();
        atualizarResumo();
      }

      function atualizarContador() {
        const concluidas = missoes.filter((m) => m.done).length;
        contadorMissoes.textContent = `${concluidas} concluídas • ${
          missoes.length - concluidas
        } pendentes`;
      }

      function atualizarResumo() {
        totalGanho = missoes
          .filter((m) => m.done)
          .reduce((a, b) => a + b.valor, 0);
        const meta = parseFloat(metaInput.value) || 0;
        resumoTexto.textContent = meta
          ? `Total ganho: R$ ${totalGanho.toFixed(2)} de R$ ${meta}`
          : "Nenhuma missão concluída ainda.";
        atualizarProgress(meta);
        atualizarGrafico(meta);
      }

      function atualizarProgress(meta) {
        const percent = meta ? Math.min((totalGanho / meta) * 100, 100) : 0;
        progressFill.style.width = percent + "%";
        let msg = "Vamos começar sua jornada!";
        if (percent >= 10 && percent < 30)
          msg = "Bom começo! Continue acelerando! 🏁";
        else if (percent >= 30 && percent < 60)
          msg = "Você está pegando o ritmo! 🚀";
        else if (percent >= 60 && percent < 90)
          msg = "Incrível! Falta pouco! 💪";
        else if (percent >= 90 && percent < 100) msg = "Quase lá! 🔥";
        else if (percent >= 100) msg = "Meta alcançada! 🏆";
        motivacaoTexto.textContent = msg;
      }

      function atualizarGrafico(meta) {
        const ctx = document.getElementById("grafico").getContext("2d");
        const valores = [totalGanho, Math.max(0, meta - totalGanho)];
        if (!chart) {
          chart = new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: ["Concluído", "Restante"],
              datasets: [
                { data: valores, backgroundColor: ["#4da3ff", "#ccc"] },
              ],
            },
            options: { plugins: { legend: { position: "bottom" } } },
          });
        } else {
          chart.data.datasets[0].data = valores;
          chart.update();
        }
      }

      function salvar() {
        localStorage.setItem(
          "missoesData",
          JSON.stringify({
            missoes,
            meta: metaInput.value,
            valorKm: valorKmInput.value,
            tipo: tipoVariedade.value,
          })
        );
      }

      // === CARROSSEL NAVEGAÇÃO ===
      prevBtn.addEventListener("click", () => {
        listaMissoes.scrollBy({ left: -300, behavior: "smooth" });
      });
      nextBtn.addEventListener("click", () => {
        listaMissoes.scrollBy({ left: 300, behavior: "smooth" });
      });
    </script>
  </body>
</html>
